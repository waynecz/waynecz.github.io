<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>express＋webpack+gulp＋nodemon初级自动化！ - Wayne</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="主要是为了彻底解放刷新键。。。。。咳咳。开始之前接触React时解除了webpack，不过后来看angular和其他事就搁置了。最近碰到Vue时，体验了下vue-cli 脚手架构建的项目，只能说，哇！！ 好爽。。什么热加载，保存时检查代码，单元测试以及一堆我还不知道的但是很强大的功能！无比顺畅">
<meta property="og:type" content="article">
<meta property="og:title" content="express＋webpack+gulp＋nodemon初级自动化！">
<meta property="og:url" content="http://waynecz.github.io/2016/04/11/express＋webpack-gulp＋nodemon前端自动化/index.html">
<meta property="og:site_name" content="Wayne">
<meta property="og:description" content="主要是为了彻底解放刷新键。。。。。咳咳。开始之前接触React时解除了webpack，不过后来看angular和其他事就搁置了。最近碰到Vue时，体验了下vue-cli 脚手架构建的项目，只能说，哇！！ 好爽。。什么热加载，保存时检查代码，单元测试以及一堆我还不知道的但是很强大的功能！无比顺畅">
<meta property="og:image" content="http://7xntdk.com1.z0.glb.clouddn.com/11.jpg">
<meta property="og:image" content="http://ali.xinshipu.cn/20130319/original/1363661582619.jpg">
<meta property="og:updated_time" content="2016-04-21T05:12:50.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="express＋webpack+gulp＋nodemon初级自动化！">
<meta name="twitter:description" content="主要是为了彻底解放刷新键。。。。。咳咳。开始之前接触React时解除了webpack，不过后来看angular和其他事就搁置了。最近碰到Vue时，体验了下vue-cli 脚手架构建的项目，只能说，哇！！ 好爽。。什么热加载，保存时检查代码，单元测试以及一堆我还不知道的但是很强大的功能！无比顺畅">
<meta name="twitter:image" content="http://7xntdk.com1.z0.glb.clouddn.com/11.jpg">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link href="/webfonts/ptserif/main.css" rel='stylesheet' type='text/css'>
  <link href="/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  
<script type="text/javascript">
var _hmt = _hmt || [];
(function() {
var hm = document.createElement("script");
hm.src = "//hm.baidu.com/hm.js?a263c908beac42a00a8426f995864225";
var s = document.getElementsByTagName("script")[0];
s.parentNode.insertBefore(hm, s);
})();
</script>

</head>

<body>
<!-- <div class="load-wrap">
  <div id="load">
    <div>G</div>
    <div>N</div>
    <div>I</div>
    <div>D</div>
    <div>A</div>
    <div>O</div>
    <div>L</div>
  </div>
</div> -->
<div class="load-wrap">
<img src="http://7xntdk.com1.z0.glb.clouddn.com/loading.gif"/>
</div>
<img id="shadow" src="css/images/wayne.png" alt="" style="display: none">
<div class="welcome">
  <div id="word" class="wordWrap">
    <span class="word word1" data-ratio="-.2"></span>
    <span class="word word2" data-ratio=".6"></span>
    <span class="word word3" data-ratio="-0.1"></span>
    <span class="word word4" data-ratio="-.6"></span>
    <span class="word word5" data-ratio="-.3"></span>
  </div>
</div>
  <div id="container">

    

<header id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <a id="main-nav-toggle" class="nav-icon" href="javascript:;"></a>
      <a id="logo" class="logo" href="/"></a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">日期</a>
        
          <a class="main-nav-link" href="/tags">标签</a>
        
          <a class="main-nav-link" href="/categories">分类</a>
        
      </nav>
    </div>
  </div>
</header>
    <section id="main" class="outer"><article id="post-express＋webpack-gulp＋nodemon前端自动化" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      express＋webpack+gulp＋nodemon初级自动化！
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2016/04/11/express＋webpack-gulp＋nodemon前端自动化/" class="article-date">
  <time datetime="2016-04-11T13:26:37.000Z" itemprop="datePublished">2016-04-11</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/前端/">前端</a>
  </div>

      
        <div class="article-comment-link-wrap">
          <a href="http://waynecz.github.io/2016/04/11/express＋webpack-gulp＋nodemon前端自动化/#disqus_thread" class="article-comment-link">评论</a>
        </div>
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="http://7xntdk.com1.z0.glb.clouddn.com/11.jpg" alt=""></p>
<p>主要是为了彻底解放刷新键。。。。。咳咳。开始<br>之前接触React时解除了webpack，不过后来看angular和其他事就搁置了。最近碰到Vue时，体验了下<a href="http://cn.vuejs.org/guide/application.html" target="_blank" rel="external">vue-cli 脚手架</a>构建的项目，只能说，<em>哇！！</em> 好爽。。什么热加载，保存时检查代码，单元测试以及一堆我还不知道的但是很强大的功能！无比顺畅<br><a id="more"></a><br>虽然之前在用的 <code>Gulp</code>(盖欧破)加上各种插件貌似也能达到差不多的效果，但是还是心痒，所以这几天笨手笨脚地学者搭了<a href="https://github.com/waynecz/Thrones" target="_blank" rel="external">这个</a>, 一个OA的demo。</p>
<p>开始，主要用到：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// web框架 前端模版</span></div><div class="line">express + art-template</div><div class="line"><span class="comment">// 自动化构建 打包(sass)</span></div><div class="line">gulp + webpack +</div><div class="line"><span class="comment">// 浏览器刷新 node重启 热加载</span></div><div class="line">browser-sync + nodemon + webpack-hot-middleware</div></pre></td></tr></table></figure></p>
<p>然后新建项目，这里用express应用生成器,具体可以看<a href="http://www.expressjs.com.cn/starter/generator.html" target="_blank" rel="external">这里</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 可能要求权限，所以sudo，这里还要感谢淘宝</span></div><div class="line">sudo cnpm install express-generator -g </div><div class="line"><span class="comment">//express + 项目名</span></div><div class="line">express myapp</div><div class="line"><span class="comment">//然后一路回车，塔哒，然后就好了</span></div></pre></td></tr></table></figure>
<p>生成的项目模版引擎默认用的<code>jade</code>,前几天突然发现了国人的一款引擎<code>art-template</code>,性能强劲，语法干净，express亲和力又强，这次就用上了！<a href="http://aui.github.io/artTemplate/" target="_blank" rel="external">贴上地址</a>.</p>
<p>首先项目目录请看<a href="https://github.com/waynecz/Thrones" target="_blank" rel="external">这里</a>，然后是webpack的配置，webpack的入门看<a href="http://zhuanlan.zhihu.com/p/20367175?columnSlug=FrontendMagazine" target="_blank" rel="external">这里</a>,先这样简单配置webpack.config.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> path         = <span class="built_in">require</span>(<span class="string">'path'</span>);</div><div class="line"><span class="keyword">var</span> autoprefixer = <span class="built_in">require</span>(<span class="string">'autoprefixer'</span>);</div><div class="line"><span class="keyword">var</span> webpack      = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</div><div class="line"></div><div class="line"><span class="comment">//一些文件夹的路径</span></div><div class="line"><span class="keyword">var</span> ROOT_PATH  = path.resolve(__dirname);</div><div class="line"><span class="keyword">var</span> SRC_PATH   = path.resolve(ROOT_PATH, <span class="string">'src'</span>);</div><div class="line"><span class="keyword">var</span> MODULE_PATH = path.resolve(ROOT_PATH, <span class="string">'./node_modules'</span>);</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = </div><div class="line">	<span class="comment">// context webpack处理entry选项时的基础路径</span></div><div class="line">    context: path.join(__dirname, <span class="string">'public'</span>),</div><div class="line">    <span class="attr">entry</span>  : [</div><div class="line">    	<span class="comment">// 会寻找src目录下的index.js</span></div><div class="line">        <span class="string">'../src'</span></div><div class="line">        ],</div><div class="line">    <span class="attr">output</span> : &#123;</div><div class="line">        <span class="attr">path</span>      : <span class="string">'/'</span>,</div><div class="line">        <span class="attr">filename</span>  : <span class="string">'bundle.js'</span>,</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">module</span> : &#123;</div><div class="line">        <span class="attr">loaders</span>: [</div><div class="line">            &#123;</div><div class="line">                <span class="attr">test</span>   : <span class="regexp">/\.scss$/</span>,</div><div class="line">                <span class="comment">// CSS预处理器们</span></div><div class="line">                loaders: [<span class="string">'style'</span>, <span class="string">'css'</span>, <span class="string">'postcss'</span>, <span class="string">'sass'</span>],</div><div class="line">                <span class="attr">include</span>: SRC_PATH</div><div class="line">            &#125;</div><div class="line">        ]</div><div class="line">    &#125;,</div><div class="line">    <span class="comment">// 选择postcss生效的插件</span></div><div class="line">    postcss: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> [autoprefixer];</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">resolve</span>: &#123;</div><div class="line">      <span class="attr">alias</span>: &#123;</div><div class="line">      	  <span class="comment">// 为了全局依赖jQuery定义的地址缩写</span></div><div class="line">          jquery: <span class="string">"../node_modules/jquery/dist/jquery.min"</span></div><div class="line">      &#125;  </div><div class="line">    &#125;,</div><div class="line">    <span class="attr">plugins</span>: [</div><div class="line">        <span class="comment">// 全局依赖jQuery</span></div><div class="line">        <span class="keyword">new</span> webpack.ProvidePlugin(&#123;</div><div class="line">            <span class="attr">$</span>: <span class="string">"jquery"</span>,</div><div class="line">            <span class="attr">jQuery</span>: <span class="string">"jquery"</span></div><div class="line">        &#125;)</div><div class="line">    ]</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>现在基本功能就是css和js打包啦，接下来加进重点，也就是热加载功能。只要你修改了webpack打包的文件，webpack会在不刷新浏览器的情况下替换掉原来的文件,无比顺畅，这里有篇<a href="http://andrewhfarmer.com/webpack-hmr-tutorial/" target="_blank" rel="external">文章</a>非常非常推荐，里面很清晰的讲了webpack在各种情况下<code>热加载</code>的实现。进入正题，首先亮出webpack配合express的兵刃:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 热加载中间件</span></div><div class="line">npm install webpack-hot-middleware --save-dev</div><div class="line"><span class="comment">// 这个没怎么理解，感觉是生成一个虚拟的环境用来存放打包文件</span></div><div class="line">npm install webpack-dev-middleware --save-dev</div><div class="line"><span class="string">`</span></div></pre></td></tr></table></figure></p>
<p>接接下来，修改<code>webpack.config.js</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 修改entry,output和plugins</span></div><div class="line">......</div><div class="line">entry  : [</div><div class="line">	<span class="comment">// 自己暂时理解为热加载文件存放的虚拟地址，请指正</span></div><div class="line">	<span class="string">'webpack-hot-middleware/client?path=/__webpack_hmr&amp;timeout=20000'</span>,</div><div class="line">	<span class="string">'../src'</span></div><div class="line">],</div><div class="line"><span class="attr">output</span> : &#123;</div><div class="line">    <span class="attr">path</span>      : <span class="string">'/'</span>,</div><div class="line">    <span class="attr">filename</span>  : <span class="string">'bundle.js'</span>,</div><div class="line">    <span class="comment">// 加入publicPath</span></div><div class="line">    publicPath: <span class="string">'/javascripts'</span></div><div class="line">&#125;,</div><div class="line">.....</div><div class="line">plugins: [</div><div class="line">	<span class="comment">// 添加下面三行</span></div><div class="line">    <span class="keyword">new</span> webpack.optimize.OccurenceOrderPlugin(),</div><div class="line">    <span class="keyword">new</span> webpack.HotModuleReplacementPlugin(),</div><div class="line">    <span class="keyword">new</span> webpack.NoErrorsPlugin(),</div><div class="line">    </div><div class="line">    <span class="keyword">new</span> webpack.ProvidePlugin(&#123;</div><div class="line">        <span class="attr">$</span>: <span class="string">"jquery"</span>,</div><div class="line">        <span class="attr">jQuery</span>: <span class="string">"jquery"</span></div><div class="line">    &#125;)</div><div class="line">]</div></pre></td></tr></table></figure></p>
<p>webpack配置暂时到这，然后进express的配置，这里我的是<code>app.js</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 加入下面这些，有个奇怪的表现，我吧下面这些代码放在整个文件的位置不同会导致</span></div><div class="line"><span class="comment">// 功能失效，最后我放在了文件的头部。。</span></div><div class="line"><span class="keyword">var</span> webpackDevMiddleware = <span class="built_in">require</span>(<span class="string">"webpack-dev-middleware"</span>);</div><div class="line"><span class="keyword">var</span> webpackHotMiddleware = <span class="built_in">require</span>(<span class="string">"webpack-hot-middleware"</span>);</div><div class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</div><div class="line"><span class="keyword">var</span> webpackConfig = <span class="built_in">require</span>(<span class="string">'./webpack.config.js'</span>);</div><div class="line"><span class="keyword">var</span> compiler = webpack(webpackConfig);</div><div class="line"></div><div class="line">app.use(webpackDevMiddleware(compiler, &#123;</div><div class="line">    <span class="attr">hot</span>: <span class="literal">true</span>,</div><div class="line">    <span class="attr">filename</span>: <span class="string">'bundle.js'</span>,</div><div class="line">    <span class="comment">// 这个publicPath就是webpack里output里的那个，自己理解为dev环境下存放打包后文件的路径</span></div><div class="line">    publicPath: webpackConfig.output.publicPath,</div><div class="line">    <span class="attr">stats</span>: &#123;</div><div class="line">        <span class="attr">colors</span>: <span class="literal">true</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">historyApiFallback</span>: <span class="literal">true</span></div><div class="line">&#125;));</div><div class="line"></div><div class="line">app.use(webpackHotMiddleware(compiler, &#123;</div><div class="line">    <span class="attr">log</span>: <span class="built_in">console</span>.log,</div><div class="line">    <span class="comment">// 这个path对应entry里的path</span></div><div class="line">    path: <span class="string">'/__webpack_hmr'</span>,</div><div class="line">    <span class="attr">heartbeat</span>: <span class="number">10</span> * <span class="number">1000</span>,</div><div class="line">&#125;));</div></pre></td></tr></table></figure></p>
<p>最后在前端里引入打包文件，这样：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 其实可以看到前面webpack的context配置为 /public --&gt;</span></div><div class="line"><span class="comment">&lt;!-- 然后 output 的 publicPath 设置为 /javascripts --&gt;</span></div><div class="line"><span class="comment">&lt;!-- 所以 最后引用的地址为 (public/) javascripts/bundle.js --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"javascripts/bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>塔哒，到这基本就粗略的实现了express加webpack的<em>打包文件!!</em>热加载，对，只有打包的文件，对于其他文件，比如<code>node的后端代码</code>和<em>这里的artTemplate应用在node中默认是建立缓存的，所以直接修改模版文件必须要重启下服务然后刷新浏览器才能做到视图更新，当然也可以关掉缓存这个功能</em></p>
<p>其实说白了就是监听这些文档的变化然后重启服务并刷新浏览器！！<br>分成两部可能更清晰点</p>
<ul>
<li>监听并重启服务</li>
<li>在服务重启完成后刷新浏览器</li>
</ul>
<p>这里要注意的其实就是重启服务需要点时间，看具体依赖情况，我这里大概需要1秒，所以刷新浏览器需要有个延迟，在服务完全重启完毕后再执行</p>
<p>先上依靠<br><figure class="highlight q"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">npm install gulp --<span class="built_in">save</span>-<span class="built_in">dev</span></div><div class="line">npm install gulp-nodemon --<span class="built_in">save</span>-<span class="built_in">dev</span></div><div class="line"><span class="comment">// browser-sync很有趣的，会代理起一个服务器，本身也拥有热加载功能(原理好像也是webpack？）</span></div><div class="line"><span class="comment">// 这里主要用来监听文件变化延迟刷新浏览器。</span></div><div class="line">npm install browser-sync --<span class="built_in">save</span>-<span class="built_in">dev</span></div></pre></td></tr></table></figure></p>
<p>配置<code>gulpfile.js</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</div><div class="line"><span class="keyword">var</span> nodemon = <span class="built_in">require</span>(<span class="string">'gulp-nodemon'</span>);</div><div class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</div><div class="line"><span class="keyword">var</span> bs = <span class="built_in">require</span>(<span class="string">'browser-sync'</span>).create();</div><div class="line"></div><div class="line"><span class="keyword">var</span> ROOT = path.resolve(__dirname);</div><div class="line"><span class="keyword">var</span> APP = path.resolve(ROOT, <span class="string">'app.js'</span>);</div><div class="line"><span class="keyword">var</span> ROUTERS = path.resolve(ROOT, <span class="string">'routes'</span>);</div><div class="line"><span class="keyword">var</span> VIEW =  path.resolve(ROOT, <span class="string">'views'</span>);</div><div class="line"></div><div class="line"><span class="comment">// browser-sync配置，配置里启动nodemon任务</span></div><div class="line">gulp.task(<span class="string">'browser-sync'</span>, [<span class="string">'nodemon'</span>], <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    bs.init(<span class="literal">null</span>, &#123;</div><div class="line">    	<span class="comment">// 这里因为express默认起的是3000端口，所以代理3000端口到4000，随自己改</span></div><div class="line">        proxy: <span class="string">"http://localhost:3000"</span>,</div><div class="line">        <span class="attr">port</span>: <span class="number">4000</span></div><div class="line">    &#125;);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// browser-sync 监听文件</span></div><div class="line">gulp.task(<span class="string">'default'</span>, [<span class="string">'browser-sync'</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    gulp.watch([<span class="string">'./routes/**/*.js'</span>,<span class="string">'./modules/*'</span>,<span class="string">'./database/*'</span>, <span class="string">'./app.js'</span>, <span class="string">'./bin/www'</span>,<span class="string">'./views/**/*.html'</span>], [<span class="string">'bs-delay'</span>]);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 延时刷新</span></div><div class="line">gulp.task(<span class="string">'bs-delay'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        bs.reload();</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'重启完毕!'</span>);</div><div class="line">    &#125;, <span class="number">2000</span>);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">gulp.task(<span class="string">'nodemon'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">cb</span>) </span>&#123;</div><div class="line">	<span class="comment">// 设个变量来防止重复重启</span></div><div class="line">    <span class="keyword">var</span> started = <span class="literal">false</span>;</div><div class="line">    nodemon(&#123;</div><div class="line">        <span class="attr">script</span>: <span class="string">'./bin/www'</span>,</div><div class="line">        <span class="comment">// 监听文件的后缀</span></div><div class="line">        ext: <span class="string">"js html"</span>,                </div><div class="line">        <span class="attr">env</span>: &#123; <span class="string">'NODE_ENV'</span>: <span class="string">'development'</span> &#125;,</div><div class="line">        <span class="comment">// 监听的路径</span></div><div class="line">        watch: [</div><div class="line">            ROUTERS,</div><div class="line">            APP,</div><div class="line">            VIEW</div><div class="line">        ]        </div><div class="line">    &#125;).on(<span class="string">'start'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (!started) &#123;</div><div class="line">            cb();</div><div class="line">            started = <span class="literal">true</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;)</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>这里可以看到，nodemon监听的文件一旦有变动后就会重启node，与此同时，其实BS也监听着这些后端文件包括artTemplate模版文件，所以一旦有改动这里再2秒后刷新浏览器。到这里差不多就可以完全解放刷新键了！</p>
<p>真实的体验效果么也还行，偶尔会抽风，还在继续改进。最后</p>
<p>收工！梅干菜丝瓜蛋汤！</p>
<p><img src="http://ali.xinshipu.cn/20130319/original/1363661582619.jpg" alt=""></p>

      
    </div>
  
    <footer class="article-footer">
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/自动化构建/">自动化构建</a></li></ul>

    </footer>
  
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/04/24/CSS3 animation 动画的流程控制/" id="article-nav-newer" class="article-nav-link-wrap">
      <div class="article-nav-title"><span>&lt;</span>&nbsp;
        
          CSS3 animation 动画的流程的简单控制
        
      </div>
    </a>
  
  
    <a href="/2016/04/06/思考产品需求6步法/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">(转)思考产品需求6步法&nbsp;<span>&gt;</span></div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
  <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'waynecz';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</section>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Wayne&nbsp;
      by <a href="http://hexo.io/" target="_blank">Hexo</a>, theme by <a href="http://github.com/waynecz">waynecz</a> modify with <a href="http://github.com/ppoffice">PPOffice</a>
    </div>
  </div>
</footer>
    
<script>
  var disqus_shortname = 'waynecz';
  
  var disqus_url = 'http://waynecz.github.io/2016/04/11/express＋webpack-gulp＋nodemon前端自动化/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="/js/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
  </div>
</body>
</html>